(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{386:function(t,e,s){t.exports=s.p+"assets/img/1_start-a-new-comparison.a927eccb.png"},387:function(t,e,s){t.exports=s.p+"assets/img/2_select-view-options.927eaa9c.png"},388:function(t,e,s){t.exports=s.p+"assets/img/3_select-and-copy.c0a8a686.png"},389:function(t,e,s){t.exports=s.p+"assets/img/6_edit-conftest-sh.30fdc81a.png"},390:function(t,e,s){t.exports=s.p+"assets/img/7_edit-manifest.cf311401.png"},405:function(t,e,s){"use strict";s.r(e);var a=s(54),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"frontmatter-title"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#frontmatter-title"}},[t._v("#")]),t._v(" "+t._s(t.$frontmatter.title))]),t._v(" "),a("p",[t._v("For your system, you may use either use the vGPU-KVM driver or a merged driver, which would supply both DRM (graphics output) and vGPU functions to your host system. Follow directions in either of the sections below, depending on your choice.")]),t._v(" "),a("p",[t._v("Alternatively, if you have a pre-patched driver package, you may skip this page and instead install that package by running the following as root, selecting the correct filename as necessary:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NVIDIA-Linux-x86_64-510.47.03-vgpu-kvm-patched.run'")]),t._v(" --dkms\n")])])]),a("p",[t._v("All directions below assume you have downloaded "),a("code",[t._v("NVIDIA-GRID-Linux-KVM-510.47.03-511.65.zip")]),t._v(" from NVIDIA's customer portal and have extracted the file into your current working directory. You will additionally need to download "),a("a",{attrs:{href:t.$withBase("/patches/510.47.03/nvidia-vgpu-vfio.patch")}},[t._v("nvidia-vgpu-vfio.patch")]),t._v(" and "),a("a",{attrs:{href:t.$withBase("/patches/510.47.03/nv-kernel.patch")}},[t._v("nv-kernel.patch")]),t._v(" into the same folder.")]),t._v(" "),a("h2",{attrs:{id:"vgpu-kvm-driver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vgpu-kvm-driver"}},[t._v("#")]),t._v(" vGPU-KVM Driver")]),t._v(" "),a("p",[t._v("This is the most simple setup, as the only modifications necessary are a small handful of patches and additional source files to support consumer GPUs and "),a("RouterLink",{attrs:{to:"/tools/vgpu-unlock-rs.html"}},[t._v("vgpu_unlock-rs")]),t._v(".")],1),t._v(" "),a("h3",{attrs:{id:"unpack-files"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unpack-files"}},[t._v("#")]),t._v(" Unpack files")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NVIDIA-Linux-x86_64-510.47.03-vgpu-kvm.run'")]),t._v(" -x --target vgpu-kvm\n")])])]),a("h3",{attrs:{id:"apply-patches"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apply-patches"}},[t._v("#")]),t._v(" Apply patches")]),t._v(" "),a("p",[t._v("These will allow compilation against Linux 5.15+ and prevent the driver from locking itself out upon detection of a consumer GPU.")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("patch vgpu-kvm/kernel/nvidia-vgpu-vfio/nvidia-vgpu-vfio.c nvidia-vgpu-vfio.patch\npatch vgpu-kvm/kernel/nvidia/nv-kernel.o_binary nv-kernel.patch\n")])])]),a("h3",{attrs:{id:"add-unlock-hooks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#add-unlock-hooks"}},[t._v("#")]),t._v(" Add unlock hooks")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://github.com/DualCoder/vgpu_unlock.git'")]),t._v(" vgpu_unlock\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -l vgpu_unlock/kern.ld vgpu-kvm/kernel/nvidia/kern.ld\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -l vgpu_unlock/vgpu_unlock_hooks.c vgpu-kvm/kernel/nvidia/vgpu_unlock_hooks.c\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$ a ldflags-y += -T $(src)/nvidia/kern.ld'")]),t._v(" vgpu-kvm/kernel/nvidia/nvidia.Kbuild\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'32 a #include \"vgpu_unlock_hooks.c\"'")]),t._v(" vgpu-kvm/kernel/nvidia/os-interface.c\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kernel/common/inc/vgpu_unlock_hooks.c 0644 KERNEL_MODULE_SRC INHERIT_PATH_DEPTH:1 MODULE:vgpu'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" vgpu-kvm/.manifest\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kernel/nvidia/kern.ld 0644 KERNEL_MODULE_SRC INHERIT_PATH_DEPTH:1 MODULE:resman'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" vgpu-kvm/.manifest\n")])])]),a("h3",{attrs:{id:"install"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install"}},[t._v("#")]),t._v(" Install")]),t._v(" "),a("p",[t._v("You can either install the driver directly ...")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("vgpu-kvm/nvidia-installer --dkms\n")])])]),a("p",[t._v("... or you can re-pack it for ease of safe-keeping (and/or use with applications such as "),a("a",{attrs:{href:"https://libvf.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("libvf.io"),a("OutboundLink")],1),t._v("):")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("vgpu-kvm/makeself.sh --target-os "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" -s"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" --target-arch "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" -m"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vgpu-kvm"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./NVIDIA-Linux-x86_64-510.47.03-vgpu-kvm-patched.run"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NVIDIA Accelerated Graphics Driver for Linux-x86_64 510.47.03 w/ Unlock Hooks"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t./nvidia-installer\n")])])]),a("h2",{attrs:{id:"merged-driver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#merged-driver"}},[t._v("#")]),t._v(" Merged Driver")]),t._v(" "),a("p",[t._v("The more complex of the two approaches, building the merged driver will require more work and possibly some judgement/trial-and-error if not working with the exact release the instructions are written against.")]),t._v(" "),a("p",[t._v("You will, in addition to the previous set of prerequisites, need to install Meld to proceed.")]),t._v(" "),a("h3",{attrs:{id:"unpack-files-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unpack-files-2"}},[t._v("#")]),t._v(" Unpack files")]),t._v(" "),a("p",[t._v("This expands the Grid and vGPU-KVM driver packages, fixes permissions and creates an intitial copy of the Grid driver to use as a base for the merged driver.")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NVIDIA-Linux-x86_64-510.47.03-grid.run'")]),t._v(" -x --target grid\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NVIDIA-Linux-x86_64-510.47.03-vgpu-kvm.run'")]),t._v(" -x --target vgpu-kvm\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" -R u+w "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -lR grid merged\n")])])]),a("h3",{attrs:{id:"resolve-differences-in-meld"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#resolve-differences-in-meld"}},[t._v("#")]),t._v(" Resolve differences in Meld")]),t._v(" "),a("ol",[a("li",[t._v("Open Meld and start a new 3-way directory comparison.")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(386),alt:"Start a new comparison"}})]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Ensure you have no filters applied and change the view option to show file status: new")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(387),alt:"Select view options"}})]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("Under "),a("code",[t._v("vgpu-kvm")]),t._v(', ctrl + click to select all the items listed in green. These are the files present in the vgpu-kvm driver that need to be copied into the merged driver. Then, right click and select "Copy to Right".')])]),t._v(" "),a("p",[a("img",{attrs:{src:s(388),alt:"Copy new files"}})]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[a("p",[t._v("Update your view options to show file status: modified")])]),t._v(" "),a("li",[a("p",[t._v("Take the "),a("code",[t._v("post-install")]),t._v(", "),a("code",[t._v("pre-uninstall")]),t._v(", "),a("code",[t._v("nvidia-sources.Kbuild")]),t._v(" and "),a("code",[t._v("nvidia-bug-report.sh")]),t._v(" from "),a("code",[t._v("vgpu-kvm")]),t._v(" and copy them to "),a("code",[t._v("merged")]),t._v(" (as was done in step 5).")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),a("p",[t._v("This does leave out the code which installs "),a("code",[t._v("nvidia-gridd")]),t._v(" and "),a("code",[t._v("nvidia-topologyd")]),t._v(", but those appear to be irrelevant on the host.")]),t._v(" "),a("p",[t._v("If that is a concern, you should manually resolve the differences within "),a("code",[t._v("post-install")]),t._v(" and "),a("code",[t._v("pre-uninstall")]),t._v(".")])]),t._v(" "),a("ol",{attrs:{start:"6"}},[a("li",[t._v("Manually edit "),a("code",[t._v("merged/conftest.sh")]),t._v(" to add the line "),a("code",[t._v("VGX_KVM_BUILD=1")]),t._v(" just above where the "),a("code",[t._v("GRID_BUILD")]),t._v(" variable is assigned.")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(389),alt:"Edit conftest.sh"}})]),t._v(" "),a("ol",{attrs:{start:"7"}},[a("li",[t._v("Add the lines from "),a("code",[t._v("vgpu-kvm")]),t._v(" into "),a("code",[t._v("merged/.manifest")])])]),t._v(" "),a("ul",[a("li",[t._v("append "),a("code",[t._v("nvidia-vgpu-vfio")]),t._v(" to line 4 (the list of modules to build)")]),t._v(" "),a("li",[t._v("take any lines that appear in under "),a("code",[t._v("vgpu-kvm/.manifest")]),t._v(" as blue or green and copy them to "),a("code",[t._v("merged/.manifest")]),t._v(" (for blue sections, you can hold ctrl and click the right arrow to get a copy menu)")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(390),alt:"Edit manifest"}})]),t._v(" "),a("ol",{attrs:{start:"8"}},[a("li",[t._v("Close Meld, making sure to save changes to the files which were manually edited.")])]),t._v(" "),a("h3",{attrs:{id:"apply-support-patches"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apply-support-patches"}},[t._v("#")]),t._v(" Apply support patches")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("patch merged/kernel/nvidia-vgpu-vfio/nvidia-vgpu-vfio.c nvidia-vgpu-vfio.patch\npatch merged/kernel/nvidia/nv-kernel.o_binary nv-kernel.patch\n")])])]),a("h3",{attrs:{id:"add-unlock-hooks-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#add-unlock-hooks-2"}},[t._v("#")]),t._v(" Add unlock hooks")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://github.com/DualCoder/vgpu_unlock.git'")]),t._v(" vgpu_unlock\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -l vgpu_unlock/kern.ld merged/kernel/nvidia/kern.ld\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -l vgpu_unlock/vgpu_unlock_hooks.c merged/kernel/nvidia/vgpu_unlock_hooks.c\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$ a ldflags-y += -T $(src)/nvidia/kern.ld'")]),t._v(" merged/kernel/nvidia/nvidia.Kbuild\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'32 a #include \"vgpu_unlock_hooks.c\"'")]),t._v(" merged/kernel/nvidia/os-interface.c\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kernel/common/inc/vgpu_unlock_hooks.c 0644 KERNEL_MODULE_SRC INHERIT_PATH_DEPTH:1 MODULE:vgpu'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" merged/.manifest\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kernel/nvidia/kern.ld 0644 KERNEL_MODULE_SRC INHERIT_PATH_DEPTH:1 MODULE:resman'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" merged/.manifest\n")])])]),a("h3",{attrs:{id:"install-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-2"}},[t._v("#")]),t._v(" Install")]),t._v(" "),a("p",[t._v("As with the vGPU-KVM driver, you can either install directly (as root) or build a resultant "),a("code",[t._v(".run")]),t._v(" package.")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("merged/nvidia-installer --dkms\n")])])]),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("merged/makeself.sh --target-os "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" -s"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" --target-arch "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" -m"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"merged"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./NVIDIA-Linux-x86_64-510.47.03-grid-vgpu-kvm.run"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NVIDIA Accelerated Graphics Driver for Linux-x86_64 510.47.03 (Merged) w/ Unlock Hooks"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t./nvidia-installer\n")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);