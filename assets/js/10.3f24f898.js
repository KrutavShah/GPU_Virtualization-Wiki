(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{407:function(t,e,a){"use strict";a.r(e);var s=a(54),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"frontmatter-title"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#frontmatter-title"}},[t._v("#")]),t._v(" "+t._s(t.$frontmatter.title))]),t._v(" "),a("h2",{attrs:{id:"creating-a-vgpu-instance"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-vgpu-instance"}},[t._v("#")]),t._v(" Creating a vGPU Instance")]),t._v(" "),a("p",[t._v("Creating a vGPU instance varies by the system. Most distributions will come with libvirt as the de-facto virtualization library and tools. For these systems, "),a("code",[t._v("mdevctl")]),t._v(" is the preferred way of managing mediated devices, which vGPU is classified as. However, some distributions such as Proxmox handle the management of mediated devices differently with their own interface.")]),t._v(" "),a("h3",{attrs:{id:"using-mdevctl-normally-with-libvirt"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-mdevctl-normally-with-libvirt"}},[t._v("#")]),t._v(" Using "),a("code",[t._v("mdevctl")]),t._v(" normally with "),a("code",[t._v("libvirt")])]),t._v(" "),a("p",[t._v("Start by finding out which vGPU you want to use by listing the available types and their features. Both "),a("code",[t._v("mdevctl types")]),t._v(" and "),a("code",[t._v("nvidia-smi vgpu -c -v")]),t._v(" (if you created the wrapper from "),a("RouterLink",{attrs:{to:"/installation/host-setup.html#optional-install-a-wrapper-for-nvidia-smi"}},[t._v("Host Setup")]),t._v(") can help you decide which type to use."),a("br"),t._v(" "),a("a",{attrs:{href:"https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_virtualization/assembly_managing-gpu-devices-in-virtual-machines_configuring-and-managing-virtualization#proc_obtaining-nvidia-vgpu-information-about-your-system_assembly_managing-nvidia-vgpu-devices",target:"_blank",rel:"noopener noreferrer"}},[t._v("RHEL documentation - Obtaining vGPU Information"),a("OutboundLink")],1)],1),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/reference/vgpu-types.html"}},[t._v("vGPU Types")]),t._v(" has helpful information to help determine which vGPU type is best suited for your use.")],1)]),t._v(" "),a("p",[t._v("Create a vGPU instance. The guide for Red Hat systems applies to other distributions as well."),a("br"),t._v(" "),a("a",{attrs:{href:"https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_virtualization/assembly_managing-gpu-devices-in-virtual-machines_configuring-and-managing-virtualization#proc_setting-up-nvidia-vgpu-devices_assembly_managing-nvidia-vgpu-devices",target:"_blank",rel:"noopener noreferrer"}},[t._v("RHEL documentation - Creating vGPU instances"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Attach your vGPU to a VM by editing the VM’s XML configuration file. (You will need to generate a UUID first)"),a("br"),t._v(" "),a("a",{attrs:{href:"https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_virtualization/assembly_managing-gpu-devices-in-virtual-machines_configuring-and-managing-virtualization#proc_assigning-a-gpu-to-a-virtual-machine_assembly_managing-gpu-devices-in-virtual-machines",target:"_blank",rel:"noopener noreferrer"}},[t._v("RHEL documentation - Attaching vGPU instances"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Here is a sample vGPU device. This block would be added to the "),a("code",[t._v("<devices>")]),t._v(" section of the XML configuration of a VM.")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("hostdev")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("mode")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("subsystem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("mdev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("managed")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("no"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("model")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("vfio-pci"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("address")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("uuid")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("30820a6f-b1a5-4503-91ca-0c10ba58692a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("hostdev")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("h3",{attrs:{id:"using-the-web-interface-on-proxmox"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-the-web-interface-on-proxmox"}},[t._v("#")]),t._v(" Using the web interface on Proxmox")]),t._v(" "),a("p",[t._v("Same as step 1 from "),a("a",{attrs:{href:"#using-mdevctl-normally-with-libvirt"}},[t._v("above")]),t._v(".")]),t._v(" "),a("p",[t._v("Generate a UUID for your VM. This can be done by either generating a new UUID with uuidgen or using your VM ID with zeroes before it in UUID format.")]),t._v(" "),a("p",[t._v("Edit your VM's configuration (i.e. "),a("code",[t._v("/etc/pve/qemu-server/101.conf")]),t._v(") and add the generated UUID to the top of the file (substitute this for the UUID you generated):")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("args: -uuid 30820a6f-b1a5-4503-91ca-0c10ba58692b\n")])])]),a("p",[t._v("Attach the vGPU device by going to the 'Hardware' tab of the VM, selecting 'Add' and then 'PCI Device'. Under 'Device:', you will be prompted a list of connected PCI devices, from which you should select your host's graphics card. After that, a new menu 'MDev Type' should appear, where you will select the vGPU profile you want to use.")]),t._v(" "),a("h2",{attrs:{id:"applying-profile-overrides"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#applying-profile-overrides"}},[t._v("#")]),t._v(" Applying Profile Overrides")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("This section needs expansion; the information here is fairly limited for the moment. Further details are available on "),a("RouterLink",{attrs:{to:"/tools/vgpu-unlock-rs.html"}},[t._v("vgpu_unlock-rs")]),t._v(".")],1)]),t._v(" "),a("p",[t._v("In order to make the most of your vGPU devices, you will want to apply some overrides to open up more capabilities such as removing the framerate limiter or changing the maximum screen resolution.")]),t._v(" "),a("p",[t._v("To do so, you will enter configuration into "),a("code",[t._v("/etc/vgpu_unlock/profile_override.toml")]),t._v(" detailing what needs to change:")]),t._v(" "),a("div",{staticClass:"language-toml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-toml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("profile.nvidia-55")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[t._v("num_displays")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[t._v("display_width")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1920")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[t._v("display_height")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1080")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[t._v("max_pixels")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2073600")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[t._v("cuda_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[t._v("frl_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),a("p",[t._v("In the example above, the profile selected is "),a("code",[t._v("nvidia-55")]),t._v(" (aka GRID P40-2A) and the following changes are applied:")]),t._v(" "),a("ul",[a("li",[t._v("Number of Displays: 1")]),t._v(" "),a("li",[t._v("Display Size: 1920 x 1080")]),t._v(" "),a("li",[t._v("Framebuffer Size: 2073600 (1920*1080)")]),t._v(" "),a("li",[t._v("CUDA Enabled: true")]),t._v(" "),a("li",[t._v("Framerate Limiter Enabled: false")])]),t._v(" "),a("p",[t._v("You will want to adjust the example to a) select the profile used when you created your vGPU(s) and b) match your specific needs (i.e. setting a different resolution).")]),t._v(" "),a("h2",{attrs:{id:"guest-vm-setup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#guest-vm-setup"}},[t._v("#")]),t._v(" Guest VM Setup")]),t._v(" "),a("p",[t._v("This section will be about installing drivers for vGPU devices in the guests/virtual machines that they are assigned to. Assuming you have already completed installation of a supported operating system on your virtual machine, you can proceed with the installation with the device drivers for a vGPU.")]),t._v(" "),a("p",[t._v("Keep in mind that drivers are only available for Microsoft Windows and Linux guests;  BSD based operating systems and MacOS are not supported, and aren’t likely to ever receive support either. Both Windows and Linux drivers are provided in the archive where you originally downloaded the host driver.")]),t._v(" "),a("h3",{attrs:{id:"microsoft-windows"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#microsoft-windows"}},[t._v("#")]),t._v(" Microsoft Windows")]),t._v(" "),a("p",[t._v("To install the drivers, simply run the corresponding executable on your virtual machine and follow the steps in the graphical installer to install the driver. Once it completes, you may or may not be asked to reboot.")]),t._v(" "),a("p",[t._v("On rare occasions, a prompt for reboot can be presented to a user which may mean that the driver might not work for some reason. A code 43 error is an example of such an error that can be caused by a configuration error or using the wrong drivers.")]),t._v(" "),a("p",[t._v("The next thing you must do is launch the NVIDIA control panel application by right clicking on the desktop and selecting it or by searching through the start menu. You can then connect to your license server by entering the server's address and the port number (default 7070) into the licensing tab.")]),t._v(" "),a("h3",{attrs:{id:"linux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux"}},[t._v("#")]),t._v(" Linux")]),t._v(" "),a("p",[t._v("There are a multitude of Linux distributions available, but Nvidia has only certified a few of them to be natively compatible with the vGPU drivers. Enterprise Linux and Debian based systems with particular kernel versions are most likely to work. Other distributions or newer versions with different and newer kernels may cause troubles during installation, and require a patch to fix as a result.")]),t._v(" "),a("p",[t._v("Before installing, you will need to blacklist nouveau drivers and rebuild the initramfs image. After that, you need to reboot.\n"),a("a",{attrs:{href:"https://access.redhat.com/solutions/1155663",target:"_blank",rel:"noopener noreferrer"}},[t._v("Red Hat Documentation - Blacklisting Nouveau drivers"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://linuxconfig.org/how-to-disable-blacklist-nouveau-nvidia-driver-on-ubuntu-20-04-focal-fossa-linux",target:"_blank",rel:"noopener noreferrer"}},[t._v("Debian/Ubuntu - Blacklisting Nouveau drivers"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v('To install the driver, simply run the included ".run" file. The installer will bring up a graphical interface in your command line that will be relatively easy to follow. Answer “yes” to the questions it presents you unless you have your own requirements.')]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./NVIDIA-Linux-x86_64-<version>-vgpu-kvm.run"')]),t._v("\n")])])]),a("p",[t._v("From here, you can reboot the virtual machine and you should be able to use a graphics accelerated desktop environment.")]),t._v(" "),a("p",[t._v("The next thing you must do is launch the NVIDIA settings application and connect to your license server. You can do this by selecting the licensing tab and entering the server's IP/hostname and port number (default 7070) into the available fields.")])])}),[],!1,null,null,null);e.default=n.exports}}]);