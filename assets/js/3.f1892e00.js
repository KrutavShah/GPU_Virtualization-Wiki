(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{386:function(s,e,t){s.exports=t.p+"assets/img/1_start-a-new-comparison.a927eccb.png"},387:function(s,e,t){s.exports=t.p+"assets/img/2_select-view-options.927eaa9c.png"},388:function(s,e,t){s.exports=t.p+"assets/img/3_select-and-copy.c0a8a686.png"},389:function(s,e,t){s.exports=t.p+"assets/img/6_edit-conftest-sh.30fdc81a.png"},390:function(s,e,t){s.exports=t.p+"assets/img/7_edit-manifest.cf311401.png"},405:function(s,e,t){"use strict";t.r(e);var a=t(54),n=Object(a.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"frontmatter-title"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#frontmatter-title"}},[s._v("#")]),s._v(" "+s._s(s.$frontmatter.title))]),s._v(" "),a("p",[s._v("For your system, you may use either use the vGPU-KVM driver or a merged driver, which would supply both DRM (graphics output) and vGPU functions to your host system. Follow directions in either of the sections below, depending on your choice.")]),s._v(" "),a("p",[s._v("Alternatively, if you have a pre-patched driver package, you may skip this page and instead install that package by running the following as root, selecting the correct filename as necessary:")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NVIDIA-Linux-x86_64-510.47.03-vgpu-kvm-patched.run'")]),s._v(" --dkms\n")])])]),a("p",[s._v("All directions below assume you have downloaded "),a("code",[s._v("NVIDIA-GRID-Linux-KVM-510.47.03-511.65.zip")]),s._v(" from NVIDIA's customer portal and have extracted the file into your current working directory. You will additionally need to download "),a("a",{attrs:{href:s.$withBase("/patches/510.47.03/nvidia-vgpu-vfio.patch")}},[s._v("nvidia-vgpu-vfio.patch")]),s._v(" and "),a("a",{attrs:{href:s.$withBase("/patches/510.47.03/nv-kernel.patch")}},[s._v("nv-kernel.patch")]),s._v(" into the same folder.")]),s._v(" "),a("h2",{attrs:{id:"vgpu-kvm-driver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vgpu-kvm-driver"}},[s._v("#")]),s._v(" vGPU-KVM Driver")]),s._v(" "),a("p",[s._v("This is the most simple setup, as the only modifications necessary are a small handful of patches and additional source files to support consumer GPUs and "),a("RouterLink",{attrs:{to:"/tools/vgpu-unlock-rs.html"}},[s._v("vgpu_unlock-rs")]),s._v(".")],1),s._v(" "),a("h3",{attrs:{id:"unpack-files"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unpack-files"}},[s._v("#")]),s._v(" Unpack files")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NVIDIA-Linux-x86_64-510.47.03-vgpu-kvm.run'")]),s._v(" -x --target vgpu-kvm\n")])])]),a("h3",{attrs:{id:"apply-patches"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apply-patches"}},[s._v("#")]),s._v(" Apply patches")]),s._v(" "),a("p",[s._v("These will allow compilation against Linux 5.15+ and prevent the driver from locking itself out upon detection of a consumer GPU.")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("patch vgpu-kvm/kernel/nvidia-vgpu-vfio/nvidia-vgpu-vfio.c nvidia-vgpu-vfio.patch\npatch vgpu-kvm/kernel/nvidia/nv-kernel.o_binary nv-kernel.patch\n")])])]),a("h3",{attrs:{id:"add-unlock-hooks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#add-unlock-hooks"}},[s._v("#")]),s._v(" Add unlock hooks")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://github.com/DualCoder/vgpu_unlock.git'")]),s._v(" vgpu_unlock\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -l vgpu_unlock/kern.ld vgpu-kvm/kernel/nvidia/kern.ld\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -l vgpu_unlock/vgpu_unlock_hooks.c vgpu-kvm/kernel/common/inc/vgpu_unlock_hooks.c\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$ a ldflags-y += -T $(src)/nvidia/kern.ld'")]),s._v(" vgpu-kvm/kernel/nvidia/nvidia.Kbuild\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'32 a #include \"vgpu_unlock_hooks.c\"'")]),s._v(" vgpu-kvm/kernel/nvidia/os-interface.c\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kernel/nvidia/kern.ld 0644 KERNEL_MODULE_SRC INHERIT_PATH_DEPTH:1 MODULE:resman'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" vgpu-kvm/.manifest\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kernel/common/inc/vgpu_unlock_hooks.c 0644 KERNEL_MODULE_SRC INHERIT_PATH_DEPTH:1 MODULE:vgpu'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" vgpu-kvm/.manifest\n")])])]),a("h3",{attrs:{id:"install"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install"}},[s._v("#")]),s._v(" Install")]),s._v(" "),a("p",[s._v("You can either install the driver directly ...")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("vgpu-kvm/nvidia-installer --dkms\n")])])]),a("p",[s._v("... or you can re-pack it for ease of safe-keeping (and/or use with applications such as "),a("a",{attrs:{href:"https://libvf.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("libvf.io"),a("OutboundLink")],1),s._v("):")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vgpu-kvm'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NVIDIA-Linux-x86_64-510.47.03-vgpu-kvm-patched'")]),s._v("\nmerged/makeself.sh --target-os "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -s"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" --target-arch "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -m"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NVIDIA-Linux-x86_64-510.47.03-vgpu-kvm-patched'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NVIDIA-Linux-x86_64-510.47.03-vgpu-kvm-patched.run'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NVIDIA Accelerated Graphics Driver for Linux-x86_64 510.47.03 w/ Unlock Hooks'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    ./nvidia-installer\nunlink "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NVIDIA-Linux-x86_64-510.47.03-vgpu-kvm-patched'")]),s._v("\n")])])]),a("h2",{attrs:{id:"merged-driver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#merged-driver"}},[s._v("#")]),s._v(" Merged Driver")]),s._v(" "),a("p",[s._v("The more complex of the two approaches, building the merged driver will require more work and possibly some judgement/trial-and-error if not working with the exact release the instructions are written against.")]),s._v(" "),a("p",[s._v("You will, in addition to the previous set of prerequisites, need to install Meld to proceed.")]),s._v(" "),a("h3",{attrs:{id:"unpack-files-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unpack-files-2"}},[s._v("#")]),s._v(" Unpack files")]),s._v(" "),a("p",[s._v("This expands the Grid and vGPU-KVM driver packages, fixes permissions and creates an intitial copy of the Grid driver to use as a base for the merged driver.")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NVIDIA-Linux-x86_64-510.47.03-grid.run'")]),s._v(" -x --target grid\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NVIDIA-Linux-x86_64-510.47.03-vgpu-kvm.run'")]),s._v(" -x --target vgpu-kvm\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" -R u+w "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -lR grid merged\n")])])]),a("h3",{attrs:{id:"resolve-differences-in-meld"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#resolve-differences-in-meld"}},[s._v("#")]),s._v(" Resolve differences in Meld")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("Open Meld and start a new 3-way directory comparison.")]),s._v(" "),a("p",[a("img",{attrs:{src:t(386),alt:"Start a new comparison"}})])]),s._v(" "),a("li",[a("p",[s._v("Ensure you have no filters applied and change the view option to show file status: new")]),s._v(" "),a("p",[a("img",{attrs:{src:t(387),alt:"Select view options"}})])]),s._v(" "),a("li",[a("p",[s._v("Under "),a("code",[s._v("vgpu-kvm")]),s._v(', ctrl + click to select all the items listed in green. These are the files present in the vgpu-kvm driver that need to be copied into the merged driver. Then, right click and select "Copy to Right".')]),s._v(" "),a("p",[a("img",{attrs:{src:t(388),alt:"Copy new files"}})])]),s._v(" "),a("li",[a("p",[s._v("Update your view options to show file status: modified")])]),s._v(" "),a("li",[a("p",[s._v("Take the "),a("code",[s._v("post-install")]),s._v(", "),a("code",[s._v("pre-uninstall")]),s._v(", "),a("code",[s._v("nvidia-sources.Kbuild")]),s._v(" and "),a("code",[s._v("nvidia-bug-report.sh")]),s._v(" from "),a("code",[s._v("vgpu-kvm")]),s._v(" and copy them to "),a("code",[s._v("merged")]),s._v(" (as was done in step 5).")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("Note")]),s._v(" "),a("p",[s._v("This does leave out the code which installs "),a("code",[s._v("nvidia-gridd")]),s._v(" and "),a("code",[s._v("nvidia-topologyd")]),s._v(", but those appear to be irrelevant on the host.")]),s._v(" "),a("p",[s._v("If that is a concern, you should manually resolve the differences within "),a("code",[s._v("post-install")]),s._v(" and "),a("code",[s._v("pre-uninstall")]),s._v(".")])])]),s._v(" "),a("li",[a("p",[s._v("Manually edit "),a("code",[s._v("merged/conftest.sh")]),s._v(" to add the line "),a("code",[s._v("VGX_KVM_BUILD=1")]),s._v(" just above where the "),a("code",[s._v("GRID_BUILD")]),s._v(" variable is assigned.")]),s._v(" "),a("p",[a("img",{attrs:{src:t(389),alt:"Edit conftest.sh"}})])]),s._v(" "),a("li",[a("p",[s._v("Add the lines from "),a("code",[s._v("vgpu-kvm")]),s._v(" into "),a("code",[s._v("merged/.manifest")])]),s._v(" "),a("ul",[a("li",[s._v("append "),a("code",[s._v("nvidia-vgpu-vfio")]),s._v(" to line 4 (the list of modules to build)")]),s._v(" "),a("li",[s._v("take any lines that appear in under "),a("code",[s._v("vgpu-kvm/.manifest")]),s._v(" as blue or green and copy them to "),a("code",[s._v("merged/.manifest")]),s._v(" (for blue sections, you can hold ctrl and click the right arrow to get a copy menu)")])]),s._v(" "),a("p",[a("img",{attrs:{src:t(390),alt:"Edit manifest"}})])]),s._v(" "),a("li",[a("p",[s._v("Close Meld, making sure to save changes to the files which were manually edited.")])])]),s._v(" "),a("h3",{attrs:{id:"apply-support-patches"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apply-support-patches"}},[s._v("#")]),s._v(" Apply support patches")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("patch merged/kernel/nvidia-vgpu-vfio/nvidia-vgpu-vfio.c nvidia-vgpu-vfio.patch\npatch merged/kernel/nvidia/nv-kernel.o_binary nv-kernel.patch\n")])])]),a("h3",{attrs:{id:"add-unlock-hooks-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#add-unlock-hooks-2"}},[s._v("#")]),s._v(" Add unlock hooks")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://github.com/DualCoder/vgpu_unlock.git'")]),s._v(" vgpu_unlock\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -l vgpu_unlock/kern.ld merged/kernel/nvidia/kern.ld\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -l vgpu_unlock/vgpu_unlock_hooks.c merged/kernel/common/inc/vgpu_unlock_hooks.c\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$ a ldflags-y += -T $(src)/nvidia/kern.ld'")]),s._v(" merged/kernel/nvidia/nvidia.Kbuild\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'32 a #include \"vgpu_unlock_hooks.c\"'")]),s._v(" merged/kernel/nvidia/os-interface.c\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kernel/nvidia/kern.ld 0644 KERNEL_MODULE_SRC INHERIT_PATH_DEPTH:1 MODULE:resman'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" merged/.manifest\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kernel/common/inc/vgpu_unlock_hooks.c 0644 KERNEL_MODULE_SRC INHERIT_PATH_DEPTH:1 MODULE:vgpu'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" merged/.manifest\n")])])]),a("h3",{attrs:{id:"install-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-2"}},[s._v("#")]),s._v(" Install")]),s._v(" "),a("p",[s._v("As with the vGPU-KVM driver, you can either install directly (as root) or build a resultant "),a("code",[s._v(".run")]),s._v(" package.")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("merged/nvidia-installer --dkms\n")])])]),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'merged'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NVIDIA-Linux-x86_64-510.47.03-grid-vgpu-kvm'")]),s._v("\nmerged/makeself.sh --target-os "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -s"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" --target-arch "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -m"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NVIDIA-Linux-x86_64-510.47.03-grid-vgpu-kvm'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NVIDIA-Linux-x86_64-510.47.03-grid-vgpu-kvm.run'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NVIDIA Accelerated Graphics Driver for Linux-x86_64 510.47.03 (Merged) w/ Unlock Hooks'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    ./nvidia-installer\nunlink "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NVIDIA-Linux-x86_64-510.47.03-grid-vgpu-kvm'")]),s._v("\n")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);