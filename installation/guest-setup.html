<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Guest Setup | vGPU Wiki</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="256x256" href="/GPU_Virtualization-Wiki/assets/img/favicon.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/GPU_Virtualization-Wiki/assets/css/0.styles.365d8210.css" as="style"><link rel="preload" href="/GPU_Virtualization-Wiki/assets/js/app.f9bfef7a.js" as="script"><link rel="preload" href="/GPU_Virtualization-Wiki/assets/js/2.6e9a635c.js" as="script"><link rel="preload" href="/GPU_Virtualization-Wiki/assets/js/10.ae3ec473.js" as="script"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/11.faade769.js"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/12.597d7745.js"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/13.21f0c3dc.js"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/14.797e9ca7.js"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/15.611458c6.js"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/16.c12a62b9.js"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/17.a63b7b7a.js"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/18.dc552ba3.js"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/3.2efed6f4.js"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/4.29ba6645.js"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/5.b0f35a3c.js"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/6.786d7c4d.js"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/7.435deacc.js"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/8.5710aafb.js"><link rel="prefetch" href="/GPU_Virtualization-Wiki/assets/js/9.7e46fca1.js">
    <link rel="stylesheet" href="/GPU_Virtualization-Wiki/assets/css/0.styles.365d8210.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/GPU_Virtualization-Wiki/" class="home-link router-link-active"><img src="/GPU_Virtualization-Wiki/assets/img/logo-nogaps.png" alt="vGPU Wiki" class="logo"> <span class="site-name can-hide">vGPU Wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/KrutavShah/GPU_Virtualization-Wiki" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/KrutavShah/GPU_Virtualization-Wiki" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/GPU_Virtualization-Wiki/overview.html" class="sidebar-link">Project Overview</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Installation Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/GPU_Virtualization-Wiki/installation/preparation.html" class="sidebar-link">Preparation</a></li><li><a href="/GPU_Virtualization-Wiki/installation/host-setup.html" class="sidebar-link">Host Setup</a></li><li><a href="/GPU_Virtualization-Wiki/installation/license-server.html" class="sidebar-link">License Server</a></li><li><a href="/GPU_Virtualization-Wiki/installation/guest-setup.html" aria-current="page" class="active sidebar-link">Guest Setup</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/GPU_Virtualization-Wiki/installation/guest-setup.html#creating-a-vgpu-instance" class="sidebar-link">Creating a vGPU Instance</a></li><li class="sidebar-sub-header"><a href="/GPU_Virtualization-Wiki/installation/guest-setup.html#guest-vm-setup" class="sidebar-link">Guest VM Setup</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reference Documentation</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tools</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="frontmatter-title"><a href="#frontmatter-title" class="header-anchor">#</a> Guest Setup</h1> <h2 id="creating-a-vgpu-instance"><a href="#creating-a-vgpu-instance" class="header-anchor">#</a> Creating a vGPU Instance</h2> <p>Creating a vGPU instance varies by the system. Most distributions will come with libvirt as the de-facto virtualization library and tools. For these systems, <code>mdevctl</code> is the preferred way of managing mediated devices, which vGPU is classified as. However, some distributions such as Proxmox handle the management of mediated devices differently with their own interface.</p> <h3 id="using-mdevctl-normally-with-libvirt"><a href="#using-mdevctl-normally-with-libvirt" class="header-anchor">#</a> Using <code>mdevctl</code> normally with <code>libvirt</code></h3> <p>Start by finding out which vGPU you want to use by listing the available types and their features. Both <code>mdevctl types</code> and <code>nvidia-smi vgpu -c -v</code> (if you created the wrapper from <a href="/GPU_Virtualization-Wiki/installation/host-setup.html#optional-install-a-wrapper-for-nvidia-smi">Host Setup</a>) can help you decide which type to use.<br> <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_virtualization/assembly_managing-gpu-devices-in-virtual-machines_configuring-and-managing-virtualization#proc_obtaining-nvidia-vgpu-information-about-your-system_assembly_managing-nvidia-vgpu-devices" target="_blank" rel="noopener noreferrer">RHEL documentation - Obtaining vGPU Information<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><a href="/GPU_Virtualization-Wiki/reference/vgpu-types.html">vGPU Types</a> has helpful information to help determine which vGPU type is best suited for your use.</p></div> <p>Create a vGPU instance. The guide for Red Hat systems applies to other distributions as well.<br> <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_virtualization/assembly_managing-gpu-devices-in-virtual-machines_configuring-and-managing-virtualization#proc_setting-up-nvidia-vgpu-devices_assembly_managing-nvidia-vgpu-devices" target="_blank" rel="noopener noreferrer">RHEL documentation - Creating vGPU instances<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Attach your vGPU to a VM by editing the VM’s XML configuration file. (You will need to generate a UUID first)<br> <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_virtualization/assembly_managing-gpu-devices-in-virtual-machines_configuring-and-managing-virtualization#proc_assigning-a-gpu-to-a-virtual-machine_assembly_managing-gpu-devices-in-virtual-machines" target="_blank" rel="noopener noreferrer">RHEL documentation - Attaching vGPU instances<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Here is a sample vGPU device. This block would be added to the <code>&lt;devices&gt;</code> section of the XML configuration of a VM.</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hostdev</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>subsystem<span class="token punctuation">'</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>mdev<span class="token punctuation">'</span></span> <span class="token attr-name">managed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>no<span class="token punctuation">'</span></span> <span class="token attr-name">model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>vfio-pci<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>address</span> <span class="token attr-name">uuid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>30820a6f-b1a5-4503-91ca-0c10ba58692a<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hostdev</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="using-the-web-interface-on-proxmox"><a href="#using-the-web-interface-on-proxmox" class="header-anchor">#</a> Using the web interface on Proxmox</h3> <p>Same as step 1 from <a href="#using-mdevctl-normally-with-libvirt">above</a>.</p> <p>Generate a UUID for your VM. This can be done by either generating a new UUID with uuidgen or using your VM ID with zeroes before it in UUID format.</p> <p>Edit your VM's configuration (i.e. <code>/etc/pve/qemu-server/101.conf</code>) and add the generated UUID to the top of the file (substitute this for the UUID you generated):</p> <div class="language- extra-class"><pre class="language-text"><code>args: -uuid 30820a6f-b1a5-4503-91ca-0c10ba58692b
</code></pre></div><p>Attach the vGPU device by going to the 'Hardware' tab of the VM, selecting 'Add' and then 'PCI Device'. Under 'Device:', you will be prompted a list of connected PCI devices, from which you should select your host's graphics card. After that, a new menu 'MDev Type' should appear, where you will select the vGPU profile you want to use.</p> <h2 id="guest-vm-setup"><a href="#guest-vm-setup" class="header-anchor">#</a> Guest VM Setup</h2> <p>This section will be about installing drivers for vGPU devices in the guests/virtual machines that they are assigned to. Assuming you have already completed installation of a supported operating system on your virtual machine, you can proceed with the installation with the device drivers for a vGPU.</p> <p>Keep in mind that drivers are only available for Microsoft Windows and Linux guests;  BSD based operating systems and MacOS are not supported, and aren’t likely to ever receive support either. Both Windows and Linux drivers are provided in the archive where you originally downloaded the host driver.</p> <h3 id="microsoft-windows"><a href="#microsoft-windows" class="header-anchor">#</a> Microsoft Windows</h3> <p>To install the drivers, simply run the corresponding executable on your virtual machine and follow the steps in the graphical installer to install the driver. Once it completes, you may or may not be asked to reboot.</p> <p>On rare occasions, a prompt for reboot can be presented to a user which may mean that the driver might not work for some reason. A code 43 error is an example of such an error that can be caused by a configuration error or using the wrong drivers.</p> <p>The next thing you must do is launch the NVIDIA control panel application by right clicking on the desktop and selecting it or by searching through the start menu. You can then connect to your license server by entering the server's address and the port number (default 7070) into the licensing tab.</p> <h3 id="linux"><a href="#linux" class="header-anchor">#</a> Linux</h3> <p>There are a multitude of Linux distributions available, but Nvidia has only certified a few of them to be natively compatible with the vGPU drivers. Enterprise Linux and Debian based systems with particular kernel versions are most likely to work. Other distributions or newer versions with different and newer kernels may cause troubles during installation, and require a patch to fix as a result.</p> <p>Before installing, you will need to blacklist nouveau drivers and rebuild the initramfs image. After that, you need to reboot.
<a href="https://access.redhat.com/solutions/1155663" target="_blank" rel="noopener noreferrer">Red Hat Documentation - Blacklisting Nouveau drivers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://linuxconfig.org/how-to-disable-blacklist-nouveau-nvidia-driver-on-ubuntu-20-04-focal-fossa-linux" target="_blank" rel="noopener noreferrer">Debian/Ubuntu - Blacklisting Nouveau drivers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>To install the driver, simply run the included &quot;.run&quot; file. The installer will bring up a graphical interface in your command line that will be relatively easy to follow. Answer “yes” to the questions it presents you unless you have your own requirements.</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">bash</span> <span class="token string">&quot;./NVIDIA-Linux-x86_64-&lt;version&gt;-vgpu-kvm.run&quot;</span>
</code></pre></div><p>From here, you can reboot the virtual machine and you should be able to use a graphics accelerated desktop environment.</p> <p>The next thing you must do is launch the NVIDIA settings application and connect to your license server. You can do this by selecting the licensing tab and entering the server's IP/hostname and port number (default 7070) into the available fields.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/KrutavShah/GPU_Virtualization-Wiki/edit/main/installation/guest-setup.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/GPU_Virtualization-Wiki/installation/license-server.html" class="prev">
        License Server
      </a></span> <span class="next"><a href="/GPU_Virtualization-Wiki/reference/vgpu-types.html">
        vGPU Types
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/GPU_Virtualization-Wiki/assets/js/app.f9bfef7a.js" defer></script><script src="/GPU_Virtualization-Wiki/assets/js/2.6e9a635c.js" defer></script><script src="/GPU_Virtualization-Wiki/assets/js/10.ae3ec473.js" defer></script>
  </body>
</html>
